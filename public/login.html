<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Omni Messenger</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
 }
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
color: #333;
 }
.login-container {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 40px;
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
width: 100%;
max-width: 400px;
text-align: center;
 }
.logo {
font-size: 3rem;
margin-bottom: 10px;
 }
.login-container h1 {
color: #4a5568;
font-size: 2rem;
margin-bottom: 10px;
 }
.login-container p {
color: #718096;
margin-bottom: 30px;
 }
.form-group {
margin-bottom: 20px;
text-align: left;
 }
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: #4a5568;
 }
.form-group input {
width: 100%;
padding: 12px 16px;
border: 2px solid #e2e8f0;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.8);
 }
.form-group input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
background: white;
 }
.btn {
width: 100%;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
padding: 14px 24px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-bottom: 20px;
 }
.btn:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
 }
.btn:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
 }
.alert {
padding: 12px 16px;
border-radius: 12px;
margin-bottom: 20px;
font-weight: 500;
text-align: center;
 }
.alert-error {
background: #fed7d7;
color: #742a2a;
border: 1px solid #fc8181;
 }
.alert-success {
background: #c6f6d5;
color: #22543d;
border: 1px solid #9ae6b4;
 }
.demo-credentials {
background: rgba(255, 255, 255, 0.1);
border-radius: 12px;
padding: 15px;
margin-top: 20px;
text-align: left;
 }
.demo-credentials h3 {
color: #4a5568;
margin-bottom: 10px;
font-size: 14px;
 }
.demo-credentials p {
font-size: 12px;
color: #718096;
margin: 5px 0;
 }
.demo-credentials .admin-section {
background: rgba(102, 126, 234, 0.1);
padding: 10px;
border-radius: 8px;
margin-top: 10px;
 }
.demo-credentials .admin-section h4 {
color: #667eea;
font-size: 12px;
margin-bottom: 5px;
 }
.loading {
display: none;
text-align: center;
color: #667eea;
margin: 10px 0;
 }
.spinner {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid #f3f3f3;
border-top: 3px solid #667eea;
border-radius: 50%;
animation: spin 1s linear infinite;
margin-right: 10px;
 }
@keyframes spin {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }
.toggle-form {
color: #667eea;
text-decoration: none;
font-size: 14px;
margin-top: 15px;
display: inline-block;
}
.toggle-form:hover {
text-decoration: underline;
}
.register-container {
display: none;
}
</style>
</head>
<body>
<div class="login-container">
<div class="logo">ðŸ’¬</div>
<h1>Omni Messenger</h1>
<p id="formDescription">Please login to access the messenger</p>
<div id="alertContainer"></div>
<div id="loadingIndicator" class="loading">
<div class="spinner"></div>
<span id="loadingText">Logging in...</span>
</div>

<!-- Login Form -->
<form id="loginForm" class="login-form">
<div class="form-group">
<label for="loginEmail">Email:</label>
<input type="email" id="loginEmail" required placeholder="Enter your email">
</div>
<div class="form-group">
<label for="loginPassword">Password:</label>
<input type="password" id="loginPassword" required placeholder="Enter your password">
</div>
<button type="submit" id="loginBtn" class="btn">Login</button>
</form>

<!-- Register Form -->
<form id="registerForm" class="register-container">
<div class="form-group">
<label for="registerName">Name:</label>
<input type="text" id="registerName" required placeholder="Enter your full name">
</div>
<div class="form-group">
<label for="registerEmail">Email:</label>
<input type="email" id="registerEmail" required placeholder="Enter your email">
</div>
<div class="form-group">
<label for="registerPassword">Password:</label>
<input type="password" id="registerPassword" required placeholder="Enter your password (min 6 chars)">
</div>
<button type="submit" id="registerBtn" class="btn">Register</button>
</form>

<a href="#" id="toggleForm" class="toggle-form">Don't have an account? Register here</a>

<div class="demo-credentials">
<h3>Demo Credentials:</h3>
<p><strong>Email:</strong> demo@example.com</p>
<p><strong>Password:</strong> demo123</p>
<div class="admin-section">
<h4>Admin Access:</h4>
<p><strong>Email:</strong> admin@example.com</p>
<p><strong>Password:</strong> admin123</p>
</div>
<p><em>Create your own account or use demo credentials</em></p>
</div>
</div>

<script>
const API_BASE_URL = '/api/auth';
let isLoginMode = true;

// DOM Elements
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const toggleForm = document.getElementById('toggleForm');
const formDescription = document.getElementById('formDescription');
const loadingIndicator = document.getElementById('loadingIndicator');
const alertContainer = document.getElementById('alertContainer');

// Toggle between login and register forms
toggleForm.addEventListener('click', (e) => {
    e.preventDefault();
    isLoginMode = !isLoginMode;
    
    if (isLoginMode) {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        toggleForm.textContent = "Don't have an account? Register here";
        formDescription.textContent = 'Please login to access the messenger';
    } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        toggleForm.textContent = 'Already have an account? Login here';
        formDescription.textContent = 'Create a new account to get started';
    }
    
    clearAlert();
});

// Login Form Handler
loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    
    if (!email || !password) {
        showAlert('Please enter both email and password', 'error');
        return;
    }
    
    await handleLogin(email, password);
});

// Register Form Handler
registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value.trim();
    
    if (!name || !email || !password) {
        showAlert('Please fill in all fields', 'error');
        return;
    }
    
    if (password.length < 6) {
        showAlert('Password must be at least 6 characters', 'error');
        return;
    }
    
    await handleRegister(name, email, password);
});

// Handle Login
async function handleLogin(email, password) {
    showLoading(true, 'Logging in...');
    document.getElementById('loginBtn').disabled = true;
    
    try {
        const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Store user data and token
            const userData = {
                ...data.data.user,
                token: data.data.token,
                loginTime: new Date().toISOString()
            };
            
            sessionStorage.setItem('omniUser', JSON.stringify(userData));
            localStorage.setItem('omniToken', data.data.token);
            
            // Show success message
            const roleText = userData.role === 'admin' ? 'Admin' : 
                           userData.role === 'moderator' ? 'Moderator' : 'User';
            showAlert(`Login successful! Welcome ${roleText}. Redirecting...`, 'success');
            
            // Redirect based on user role
            setTimeout(() => {
                if (userData.role === 'admin') {
                    window.location.href = 'adminDashboard.html';
                } else if (userData.role === 'moderator') {
                    window.location.href = 'moderatorDashboard.html';
                } else {
                    window.location.href = 'index.html';
                }
            }, 1500);
            
        } else {
            showAlert(data.message || 'Login failed', 'error');
        }
        
    } catch (error) {
        console.error('Login error:', error);
        showAlert('Network error. Please check your connection and try again.', 'error');
    } finally {
        showLoading(false);
        document.getElementById('loginBtn').disabled = false;
    }
}

// Handle Register
async function handleRegister(name, email, password) {
    showLoading(true, 'Creating account...');
    document.getElementById('registerBtn').disabled = true;
    
    try {
        const response = await fetch(`${API_BASE_URL}/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name, email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAlert('Account created successfully! You can now login.', 'success');
            
            // Clear form
            document.getElementById('registerForm').reset();
            
            // Switch to login form after 2 seconds
            setTimeout(() => {
                toggleForm.click();
                // Pre-fill email in login form
                document.getElementById('loginEmail').value = email;
            }, 2000);
            
        } else {
            showAlert(data.message || 'Registration failed', 'error');
        }
        
    } catch (error) {
        console.error('Registration error:', error);
        showAlert('Network error. Please check your connection and try again.', 'error');
    } finally {
        showLoading(false);
        document.getElementById('registerBtn').disabled = false;
    }
}

// Utility Functions
function showAlert(message, type) {
    alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
    
    if (type === 'success') {
        setTimeout(() => {
            clearAlert();
        }, 5000);
    }
}

function clearAlert() {
    alertContainer.innerHTML = '';
}

function showLoading(show, text = 'Loading...') {
    const loadingText = document.getElementById('loadingText');
    loadingText.textContent = text;
    loadingIndicator.style.display = show ? 'block' : 'none';
}

// Check if user is already logged in
function checkExistingLogin() {
    const userData = sessionStorage.getItem('omniUser');
    const token = localStorage.getItem('omniToken');
    
    if (userData && token) {
        const user = JSON.parse(userData);
        // Redirect to appropriate dashboard
        if (user.role === 'admin') {
            window.location.href = 'adminDashboard.html';
        } else if (user.role === 'moderator') {
            window.location.href = 'moderatorDashboard.html';
        } else {
            window.location.href = 'index.html';
        }
    }
}

// Check for existing login on page load
window.addEventListener('load', checkExistingLogin);

// Demo credentials auto-fill functionality
document.addEventListener('click', (e) => {
    if (e.target.closest('.demo-credentials')) {
        const isAdminSection = e.target.closest('.admin-section');
        
        if (isAdminSection) {
            document.getElementById('loginEmail').value = 'admin@example.com';
            document.getElementById('loginPassword').value = 'admin123';
        } else {
            document.getElementById('loginEmail').value = 'demo@example.com';
            document.getElementById('loginPassword').value = 'demo123';
        }
        
        // Switch to login form if in register mode
        if (!isLoginMode) {
            toggleForm.click();
        }
    }
});
</script>
</body>
</html>